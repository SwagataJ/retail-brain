# Retail Brain

AI-powered decision-making platform for retail and marketplace teams.

## Overview

Retail Brain unifies demand forecasting, customer intelligence, pricing optimization, and natural language interaction into a single system. It processes sales transactions, customer behavior, and market signals through specialized ML pipelines to generate actionable retail insights.

**Current status:** Synthetic data generation, sales forecasting (NBEATSx), and customer intelligence (segmentation, churn prediction, re-engagement) are implemented and working. Pricing optimization and the AI copilot interface are on the roadmap.

## Project Structure

```
retail-brain/
├── scripts/
│   ├── generate_data.py       # Synthetic data generator (6 CSVs)
│   ├── train_forecast.py      # NBEATSx training & validation pipeline
│   ├── predict_forecast.py    # 30-day forecast generation
│   └── customer_intelligence.py  # Segmentation, churn & recommendations
├── data/
│   ├── products.csv           # ~2,000 products across 5 categories
│   ├── stores.csv             # ~100 stores (mall, standalone, online)
│   ├── promotions.csv         # ~50 promotions
│   ├── customers.csv          # ~100,000 customers (4 segments)
│   ├── transactions.csv       # ~500,000 transactions over 2 years
│   ├── transaction_items.csv  # ~1,200,000 line items
│   ├── daily_sales.csv        # Aggregated daily revenue by category
│   ├── forecasts/             # Forecast outputs & evaluation plots
│   └── customer_intelligence/ # Segmentation & churn outputs (CSVs + PNGs)
├── models/
│   └── nbeats_model/          # Saved NBEATSx production model
├── requirements.txt             # Python dependencies
├── design.md                  # System architecture & design document
├── requirements.md            # Detailed requirements & acceptance criteria
└── LICENSE                    # Apache 2.0
```

## Quick Start

```bash
# Clone the repo
git clone https://github.com/SwagataJ/retail-brain.git
cd retail-brain

# Create and activate virtual environment
python3 -m venv retail_brain_env
source retail_brain_env/bin/activate

# Install dependencies
pip install -r requirements.txt

# 1. Generate synthetic data (~2M rows across 6 CSVs)
python scripts/generate_data.py

# 2. Train the forecasting model
python scripts/train_forecast.py

# 3. Generate 30-day predictions
python scripts/predict_forecast.py
```

## Dataset

The synthetic dataset is generated by `scripts/generate_data.py` and simulates a multi-category retail business over 2 years (Jan 2024 – Dec 2025).

| File | Rows | Description |
|------|------|-------------|
| `products.csv` | ~2,000 | Products across 5 categories (Electronics, Clothing, Groceries, Home, Beauty) with base price, cost, and brand |
| `stores.csv` | ~100 | Stores of 3 types: mall, standalone, and online |
| `customers.csv` | ~100,000 | Customers across 4 segments: high_value (10%), regular (45%), bargain_hunter (25%), churned (20%) |
| `promotions.csv` | ~50 | Category-level and product-level promotions with 5–40% discounts |
| `transactions.csv` | ~500,000 | Purchase transactions linked to customers and stores |
| `transaction_items.csv` | ~1,200,000 | Line items with unit price, quantity, and discount applied |

**Embedded patterns:**
- **Seasonality** — Nov-Dec sales spike (1.35–1.50x), Jan-Feb dip (0.70–0.75x)
- **Weekend effect** — 1.30x multiplier on Sat-Sun
- **Online trend** — Online store sales grow linearly from 1.0x to 1.6x over 2 years
- **Customer segments** — High-value customers buy more items per transaction; churned customers stop buying after 6 months
- **Price elasticity** — Electronics demand is highly elastic to discounts; Groceries are inelastic
- **Bargain hunters** — 50% chance of self-applying small coupons (5–15%) when no promo is active

## Sales Forecasting

The forecasting pipeline uses **NBEATSx** (Neural Basis Expansion Analysis with exogenous variables) via the [neuralforecast](https://github.com/Nixtla/neuralforecast) library.

**Model configuration:**
- Architecture: identity + trend + seasonality stacks, each with 512-unit MLP blocks
- Input window: 60 days, forecast horizon: 30 days
- Exogenous features: day-of-week (cyclical), month (cyclical), weekend flag, active promotion count
- Training: MAE loss, early stopping (patience 50), 1000 max steps

**Categories forecasted:** Beauty, Clothing, Electronics, Groceries, Home

**Validation results** (Oct 2025 holdout):

| Category | MAE | RMSE | MAPE |
|----------|-----|------|------|
| Beauty | $20,664 | $23,369 | 15.6% |
| Clothing | $22,454 | $27,182 | 10.4% |
| Electronics | $310,095 | $342,944 | 19.4% |
| Groceries | $3,691 | $4,222 | 11.4% |
| Home | $64,689 | $71,297 | 16.7% |
| **Overall** | **$84,319** | **$157,478** | **14.7%** |

**Embedded data patterns** the model captures:
- Seasonality (Nov-Dec spike, Jan-Feb dip)
- Weekend sales uplift
- Promotion-driven demand with category-level price elasticity
- Upward trend in online channel sales

## Customer Intelligence

The customer intelligence pipeline (`scripts/customer_intelligence.py`) segments customers, predicts churn, analyzes category affinity, and generates re-engagement recommendations.

```bash
python scripts/customer_intelligence.py
```

**Pipeline steps:**

1. **RFM Analysis** — Recency, Frequency, Monetary scores with quintile rankings for all ~100k customers
2. **Behavioral Segmentation** — Mutually exclusive segments assigned in priority order:
   - **High-Value Lapsed** — Top 25% ABV + 180+ days inactive
   - **At-Risk** — H1→H2 2025 frequency declined 50%+
   - **New** — First purchase within 30 days of reference date
   - **Loyal** — 5+ purchases
   - **Repeat** — 2-5 purchases, active within 90 days
   - **Inactive** — Everyone else
3. **Churn Prediction** — Random Forest classifier (200 trees) trained on RFM scores, tenure, frequency trends, and purchase cadence; outputs per-customer churn probability and risk tier (Low/Medium/High)
4. **Category Affinity** — Share-of-wallet analysis per segment across 5 product categories
5. **Re-engagement Recommendations** — Per-segment timing and action recommendations referencing top affinity categories

**Outputs** (in `data/customer_intelligence/`):

| File | Description |
|------|-------------|
| `rfm_scores.csv` | Per-customer RFM scores, segment, churn probability |
| `segment_summary.csv` | Aggregate metrics per segment |
| `category_affinity.csv` | Segment x category affinity percentages |
| `churn_predictions.csv` | Per-customer churn probability and risk tier |
| `recommendations.csv` | Timing and action per segment |
| `segment_distribution.png` | Pie chart of segment sizes |
| `rfm_heatmap.png` | Average RFM scores by segment |
| `churn_feature_importance.png` | Random Forest feature importances |
| `category_affinity_heatmap.png` | Segment x category heatmap |

## Roadmap

| Module | Description | Status |
|--------|-------------|--------|
| Data Generation | Synthetic retail dataset with realistic patterns | Done |
| Sales Forecasting | NBEATSx 30-day revenue forecasting by category | Done |
| Customer Intelligence | Segmentation, churn prediction, re-engagement targeting | Done |
| Pricing Optimization | Price elasticity modeling, promotion ROI, markdown optimization | Planned |
| AI Copilot | Natural language interface for business users | Planned |

## License

This project is licensed under the Apache License 2.0. See [LICENSE](LICENSE) for details.
